window.b3e=window.b3e||{},window.b3e.draw=window.b3e.draw||{},window.b3e.editor=window.b3e.editor||{},window.b3e.project=window.b3e.project||{},window.b3e.tree=window.b3e.tree||{},window.b3e.VERSION="0.3.0";
!function(){"use strict";var t=function(t){this.Container_constructor();var i=t.prototype||t;this.id=b3.createUUID(),this.node=t,this.name=i.name,this.title=i.title||this.name,this.category=i.category,this.description=i.description||"",this.properties=tine.merge({},i.properties),this._settings=null,this._inConnection=null,this._outConnections=[],this._isSelected=null,this._isDragging=null,this._dragOffsetX=null,this._dragOffsetY=null,this._width=null,this._height=null,this._displayShape=new createjs.Shape,this._displaySymbol=null,this._displayShadow=null},i=createjs.extend(t,createjs.Container);i._applySettings=function(t){this._settings=t;var i=this._settings.get("selection_color");this._displayShadow=new createjs.Shadow(i,0,0,5),this._redraw()},i._redraw=function(){var t=this.name,i=this.category.toLowerCase(),s=b3e.draw.SHAPES[i],e=b3e.draw.SYMBOLS[t]||b3e.draw.textSymbol;this._width=this._settings.get("block_"+i+"_width"),this._height=this._settings.get("block_"+i+"_height"),this.removeAllChildren(),this._displaySymbol=e(this,this._settings),this._displayShape.graphics.clear(),this._displayShape=s(this,this._settings),this.addChild(this._displayShape),this.addChild(this._displaySymbol)},i._copy=function(){var t=new b3e.Block(this.node);return t.category=this.category,t.title=this.title,t.description=this.description,t.properties=tine.merge({},this.properties),t._applySettings(this._settings),t.x=this.x,t.y=this.y,t},i._snap=function(){var t=this._settings.get("snap_x"),i=this._settings.get("snap_y"),s=this.x%t,e=this.y%i;0>s&&(s=t+s),0>e&&(e=i+e),this.x-=s,this.y-=e},i._getInAnchorPosition=function(){return{x:this.x-this._width/2-this._settings.get("anchor_offset_x"),y:this.y-this._height/2-this._settings.get("anchor_offset_x")}},i._getOutAnchorPosition=function(){return{x:this.x+this._width/2+this._settings.get("anchor_offset_x"),y:this.y+this._height/2+this._settings.get("anchor_offset_x")}},i._select=function(){this._isSelected=!0,this._displayShape.shadow=this._displayShadow},i._deselect=function(){this._isSelected=!1,this._displayShape.shadow=null},i._collapse=function(){},i._expand=function(){},i._hitTest=function(t,i){return this._displayShape.hitTest(t-this.x,i-this.y)},i._hitBody=function(t,i){return"horizontal"===this._settings.get("layout")?Math.abs(t-this.x)<this._width/2:Math.abs(i-this.y)<this._height/2},i._hitInAnchor=function(t,i){if("horizontal"===this._settings.get("layout")){var s=t-this.x;return Math.abs(s)>this._width/2&&0>s}var e=i-this.y;return Math.abs(e)>this._height/2&&0>e},i._hitOutAnchor=function(t,i){if("horizontal"===this._settings.get("layout")){var s=t-this.x;return Math.abs(s)>this._width/2&&s>0}var e=i-this.y;return Math.abs(e)>this._height/2&&e>0},i._isContainedIn=function(t,i,s,e){return t<this.x-this._width/2&&i<this.y-this._height/2&&s>this.x+this._width/2&&e>this.y+this._height/2?!0:!1},i.getTitle=function(){var t=this.title||this.name,i=this;return t.replace(/(<\w+>)/g,function(t,s){var e=s.substring(1,s.length-1);return i.properties.hasOwnProperty(e)?i.properties[e]:t})},i.traversal=function(t,i){for(var s=[this];s.length>0;){var e=s.pop();if(t.call(i,e)===!1)return;for(var h=e._outConnections.length-1;h>=0;h--){var n=e._outConnections[h];n._outBlock&&s.push(n._outBlock)}}},b3e.Block=createjs.promote(t,"Container")}();
!function(){"use strict";b3e.Command=function(n,t){function o(n,t,o){t.apply(n,o)}if(3!==n.length)throw"Invalid undo command, must have [target, method, args]";if(3!==t.length)throw"Invalid redo command, must have [target, method, args]";this.context=null,this.redo=function(){o(t[0],t[1],t[2])},this.undo=function(){o(n[0],n[1],n[2])}},b3e.Commands=function(n){this.context=null,this.redo=function(){for(var t=0;t<n.length;t++)n[t].redo()},this.undo=function(){for(var t=n.length-1;t>=0;t--)n[t].undo()}}}();
!function(){"use strict";var t=function(){this.Shape_constructor(),this._settings=null,this._inBlock=null,this._outBlock=null},o=createjs.extend(t,createjs.Shape);o._applySettings=function(t){this._settings=t,this._redraw()},o._redraw=function(t,o,i,n){if((this._inBlock||t||o)&&(this._outBlock||i||n)){var e=this._settings,r=this.graphics,s=e.get("connection_width"),c=e.get("connection_color"),h=e.get("anchor_radius")+e.get("anchor_border_width"),l=e.get("anchor_radius")/2,a=e.get("layout"),_=0,u=0,g=0,k=0,d=0;if(0!==t&&!t){var B=this._inBlock._getOutAnchorPosition();"horizontal"===a?(t=B.x,o=this._inBlock.y):(t=this._inBlock.x,o=B.y)}if(0!==i&&!i){var S=this._outBlock._getInAnchorPosition();"horizontal"===a?(i=S.x-h,n=this._outBlock.y):(i=this._outBlock.x,n=S.y-h)}"horizontal"===a?(_=2.5*(i-t)/4,k=-l):(u=2.5*(n-o)/4,d=-l,g=90),r.clear(),r.setStrokeStyle(s,"round"),r.beginStroke(c),r.moveTo(t,o),r.bezierCurveTo(t+_,o+u,i-_,n-u,i,n),r.beginFill(c),r.drawPolyStar(i+k,n+d,l,3,0,g),r.endFill(),r.endStroke()}},b3e.Connection=createjs.promote(t,"Shape")}();

!function(){"use strict";b3e.Node=function(t){this.spec=null,this.name=null,this.title=null,this.category=null,this.description=null,this.properties={},this.isDefault=!!t,this.copy=function(){var t=new b3e.Node(this.isDefault);return t.spec=this.spec,t.name=this.name,t.title=this.title,t.category=this.category,t.description=this.description,t.properties=this.properties,t}}}();
!function(){"use strict";var t=function(){this.Shape_constructor(),this._settings=null,this.alpha=.3,this.visible=!1},e=createjs.extend(t,createjs.Shape);e._applySettings=function(t){this._settings=t,this._redraw()},e._redraw=function(t,e,i,s){var a=this._settings.get("selection_color"),n=this.graphics,h=Math.min(t,i),r=Math.min(e,s),c=Math.abs(t-i),l=Math.abs(e-s);n.clear(),n.beginFill(a),n.drawRect(h,r,c,l),n.endFill()},b3e.SelectionBox=createjs.promote(t,"Shape")}();
!function(){"use strict";var t=function(){this._dict={}},i=t.prototype;i.clear=function(){this._dict={}},i.set=function(t,i){this._dict[t]=i},i.get=function(t){return this._dict[t]},i.load=function(t){for(var i in t)this.set(i,t[i])},b3e.SettingsManager=t}();
JSON3||(JSON3=JSON),String.prototype.format||(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(r,e){return"undefined"!=typeof t[e]?t[e]:r})}),Array.prototype.remove||(Array.prototype.remove=function(){for(var t,r,e=arguments,o=e.length;o&&this.length;)for(t=e[--o];-1!==(r=this.indexOf(t));)this.splice(r,1);return this}),Array.prototype.forEach||(Array.prototype.forEach=function(t,r){var e,o;if(null===this)throw new TypeError(" this is null or not defined");var n=Object(this),i=n.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(e=r),o=0;i>o;){var p;o in n&&(p=n[o],t.call(e,p,o,n)),o++}}),Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=e.length;return function(n){if("object"!=typeof n&&("function"!=typeof n||null===n))throw new TypeError("Object.keys called on non-object");var i,p,f=[];for(i in n)t.call(n,i)&&f.push(i);if(r)for(p=0;o>p;p++)t.call(n,e[p])&&f.push(e[p]);return f}}());
!function(){"use strict";var o={zoom_initial:1,zoom_min:.25,zoom_max:2,zoom_step:.25,snap_x:12,snap_y:12,snap_offset_x:0,snap_offset_y:0,layout:"horizontal",max_history:100,background_color:"#171717",selection_color:"#4BB2FD",block_border_color:"#6D6D6D",block_symbol_color:"#333333",anchor_background_color:"#EFEFEF",connection_color:"#6D6D6D",root_color:"#AFAFAF",decorator_color:"#A4CCFB",composite_color:"#A4CCFB",tree_color:"#F7CB45",action_color:"#A3C83F",condition_color:"#FFFFFF",connection_width:2,anchor_border_width:2,anchor_radius:7,anchor_offset_x:4,anchor_offset_y:0,block_border_width:2,block_root_width:40,block_root_height:40,block_tree_width:160,block_tree_height:40,block_composite_width:40,block_composite_height:40,block_decorator_width:60,block_decorator_height:60,block_action_width:160,block_action_height:40,block_condition_width:160,block_condition_height:40};b3e.DEFAULT_SETTINGS=o}();
!function(){"use strict";var o=function(o,r,e,t,a,i,h){o.graphics.beginFill(a),o.graphics.setStrokeStyle(i,"round"),o.graphics.beginStroke(h),o.graphics.drawCircle(r,e,t),o.graphics.endStroke(),o.graphics.endFill()},r=function(o,r,e,t,a,i,h){o.graphics.beginFill(a),o.graphics.setStrokeStyle(i,"round"),o.graphics.beginStroke(h),o.graphics.drawRoundRect(-r/2,-e/2,r,e,t),o.graphics.endStroke(),o.graphics.endFill()},e=function(o,r,e,t,a,i,h){o.graphics.beginFill(a),o.graphics.setStrokeStyle(i,"round"),o.graphics.beginStroke(h),o.graphics.moveTo(-r/2,0),o.graphics.lineTo(-r/2+10,-e/2),o.graphics.lineTo(r/2-10,-e/2),o.graphics.lineTo(r/2,0),o.graphics.lineTo(r/2-10,e/2),o.graphics.lineTo(-r/2+10,e/2),o.graphics.lineTo(-r/2,0),o.graphics.endStroke(),o.graphics.endFill()},t=function(o,r,e,t,a,i){o.graphics.beginFill(t),o.graphics.setStrokeStyle(a,"round"),o.graphics.beginStroke(i),o.graphics.drawEllipse(-r/2,-e/2,r,e),o.graphics.endStroke(),o.graphics.endFill()},a=function(o,r,e,t,a,i){o.graphics.beginFill(t),o.graphics.setStrokeStyle(a,"round"),o.graphics.beginStroke(i),o.graphics.moveTo(0,e/2),o.graphics.lineTo(r/2,0),o.graphics.lineTo(0,-e/2),o.graphics.lineTo(-r/2,0),o.graphics.lineTo(0,e/2),o.graphics.endStroke(),o.graphics.endFill()};b3e.draw.rootShape=function(e,t){var a=e._width,i=e._height,h=t.get("anchor_offset_x"),c=e._displayShape,g=0,_=0;return"horizontal"===t.get("layout")?g=a/2+h:_=i/2+h,o(c,g,_,t.get("anchor_radius"),t.get("anchor_background_color"),t.get("anchor_border_width"),t.get("block_border_color")),r(c,a,i,15,t.get("root_color"),t.get("block_border_width"),t.get("block_border_color")),c},b3e.draw.compositeShape=function(e,t){var a=e._displaySymbol.getBounds(),i=0;a&&(i=a.width+20);var h=Math.max(i,e._width),c=e._height,g=t.get("anchor_offset_x"),_=e._displayShape;e._width=h,e._height=c;var d=0,n=0;return"horizontal"===t.get("layout")?d=h/2+g:n=c/2+g,o(_,d,n,t.get("anchor_radius"),t.get("anchor_background_color"),t.get("anchor_border_width"),t.get("block_border_color")),o(_,-d,-n,t.get("anchor_radius"),t.get("anchor_background_color"),t.get("anchor_border_width"),t.get("block_border_color")),r(_,h,c,15,t.get("composite_color"),t.get("block_border_width"),t.get("block_border_color")),_},b3e.draw.decoratorShape=function(r,e){var t=r._displaySymbol.getBounds(),i=Math.max(t.width+40,r._width),h=Math.max(t.height+50,r._height),c=e.get("anchor_offset_x"),g=r._displayShape;r._width=i,r._height=h;var _=0,d=0;return"horizontal"===e.get("layout")?_=i/2+c:d=h/2+c,o(g,_,d,e.get("anchor_radius"),e.get("anchor_background_color"),e.get("anchor_border_width"),e.get("block_border_color")),o(g,-_,-d,e.get("anchor_radius"),e.get("anchor_background_color"),e.get("anchor_border_width"),e.get("block_border_color")),a(g,i,h,e.get("decorator_color"),e.get("block_border_width"),e.get("block_border_color")),g},b3e.draw.actionShape=function(e,t){var a=e._displaySymbol.getBounds(),i=Math.max(a.width+15,e._width),h=Math.max(a.height+15,e._height),c=t.get("anchor_offset_x"),g=e._displayShape;e._width=i,e._height=h;var _=0,d=0;return"horizontal"===t.get("layout")?_=i/2+c:d=h/2+c,o(g,-_,-d,t.get("anchor_radius"),t.get("anchor_background_color"),t.get("anchor_border_width"),t.get("block_border_color")),r(g,i,h,15,t.get("action_color"),t.get("block_border_width"),t.get("block_border_color")),g},b3e.draw.conditionShape=function(r,e){var a=r._displaySymbol.getBounds(),i=Math.max(a.width+15,r._width),h=Math.max(a.height+15,r._height),c=e.get("anchor_offset_x"),g=r._displayShape;return r._width=i,r._height=h,o(g,-i/2-c,0,e.get("anchor_radius"),e.get("anchor_background_color"),e.get("anchor_border_width"),e.get("block_border_color")),t(g,i,h,e.get("condition_color"),e.get("block_border_width"),e.get("block_border_color")),g},b3e.draw.treeShape=function(r,t){var a=r._displaySymbol.getBounds(),i=Math.max(a.width+15,r._width),h=Math.max(a.height+15,r._height),c=t.get("anchor_offset_x"),g=r._displayShape;r._width=i,r._height=h;var _=0,d=0;return"horizontal"===t.get("layout")?_=i/2+c:d=h/2+c,o(g,-_,-d,t.get("anchor_radius"),t.get("anchor_background_color"),t.get("anchor_border_width"),t.get("block_border_color")),e(g,i,h,15,t.get("tree_color"),t.get("block_border_width"),t.get("block_border_color")),g},b3e.draw.SHAPES={root:b3e.draw.rootShape,tree:b3e.draw.treeShape,composite:b3e.draw.compositeShape,decorator:b3e.draw.decoratorShape,action:b3e.draw.actionShape,condition:b3e.draw.conditionShape}}();
!function(){"use strict";b3e.draw.rootSymbol=function(e,r){var i=new createjs.Shape,o=(e._width,e._height),t=o/20,a=o/5,c=r.get("block_symbol_color");return i.graphics.setStrokeStyle(t,"round"),i.graphics.beginStroke(c),i.graphics.drawCircle(0,0,a),i.graphics.moveTo(-a,a),i.graphics.lineTo(a,-a),i.graphics.endStroke(),i},b3e.draw.sequenceSymbol=function(e,r){var i=new createjs.Shape,o=(e._width,e._height),t=o/20,a=o/4,c=r.get("block_symbol_color");return i.graphics.setStrokeStyle(t,"round"),i.graphics.beginStroke(c),i.graphics.beginFill(c),i.graphics.moveTo(-a,0),i.graphics.lineTo(a,0),i.graphics.drawPolyStar(a/2,0,a/2,3,0,0),i.graphics.endFill(),i.graphics.endStroke(),i},b3e.draw.memsequenceSymbol=function(e,r){var i=new createjs.Shape,o=(e._width,e._height),t=o/20,a=o/4,c=r.get("block_symbol_color");return i.graphics.setStrokeStyle(t,"round"),i.graphics.beginStroke(c),i.graphics.beginFill(c),i.graphics.drawPolyStar(0,.75*-a,a/2,6,a/10,0),i.graphics.setStrokeStyle(t,"round"),i.graphics.beginStroke(c),i.graphics.beginFill(c),i.graphics.moveTo(-a,a/2),i.graphics.lineTo(a,a/2),i.graphics.drawPolyStar(a/2,a/2,a/2,3,0,0),i.graphics.endFill(),i.graphics.endStroke(),i},b3e.draw.prioritySymbol=function(e,r){var i=new createjs.Shape,o=(e._width,e._height),t=o/20,a=o/8,c=r.get("block_symbol_color");return i.graphics.setStrokeStyle(t,"round"),i.graphics.beginStroke(c),i.graphics.arc(0,-a,a,3.141561,1.570796,!1),i.graphics.lineTo(0,a),i.graphics.beginFill(c),i.graphics.drawCircle(0,2*a,t/2),i.graphics.endFill(),i.graphics.endStroke(),i},b3e.draw.memprioritySymbol=function(e,r){var i=new createjs.Shape,o=(e._width,e._height),t=o/20,a=o/8,c=r.get("block_symbol_color");return i.graphics.setStrokeStyle(t,"round"),i.graphics.beginStroke(c),i.graphics.arc(-a,-a,a,3.141561,1.570796,!1),i.graphics.lineTo(-a,a),i.graphics.beginFill(c),i.graphics.drawCircle(-a,2*a,t/2),i.graphics.drawPolyStar(1.5*a,0,a/2,6,a/10,0),i.graphics.endFill(),i.graphics.endStroke(),i},b3e.draw.textSymbol=function(e,r){var i=new createjs.Text(e.getTitle(),"18px Arial",r.get("block_symbol_color"));i.textAlign="center";var o=i.getBounds();return i.regY=o.height/2,i},b3e.draw.SYMBOLS={root:b3e.draw.rootSymbol,sequence:b3e.draw.sequenceSymbol,select:b3e.draw.prioritySymbol}}();
!function(){"use strict";var t=function(){this.Container_constructor(),this._project=null,this._game=null,this._settings=new b3e.SettingsManager,this._dirty=0,this._systems=[],this.project=null,this["export"]=null,this["import"]=null,this.shortcuts=null,this._createGame()},e=createjs.extend(t,createjs.Container);e._createGame=function(){var t=this;this._game=new tine.Game(null,{update:function(){t._update()}}),this._initialize()},e._initialize=function(){var t=this,e=function(){t._game.canvas.width=window.innerWidth,t._game.canvas.height=window.innerHeight};window.onresize=e,e(),this._game.stage.addChild(this),this.project=new b3e.editor.ProjectManager(this),this["export"]=new b3e.editor.ExportManager(this),this["import"]=new b3e.editor.ImportManager(this),this.shortcuts=new b3e.editor.ShortcutManager(this),this._systems.push(new b3e.editor.CameraSystem(this)),this._systems.push(new b3e.editor.ConnectionSystem(this)),this._systems.push(new b3e.editor.SelectionSystem(this)),this._systems.push(new b3e.editor.DragSystem(this)),this._systems.push(new b3e.editor.CollapseSystem(this)),this._systems.push(new b3e.editor.ShortcutSystem(this)),this.applySettings("default")},e._update=function(){var t=this._game.time.delta;this._systems.forEach(function(e){e.update(t)})},e.trigger=function(t,e,s){s=s||{};var i=new createjs.Event(t);i._target=e,i._data=s,this.dispatchEvent(i)},e.applySettings=function(t){"default"===t&&(t=b3e.DEFAULT_SETTINGS,this._settings.clear()),t&&this._settings.load(t);var e=this._game.canvas;e.style.backgroundColor=this._settings.get("background_color"),this.project._applySettings(this._settings),this["export"]._applySettings(this._settings),this["import"]._applySettings(this._settings),this.shortcuts._applySettings(this._settings)},e.preview=function(t){var e=document.createElement("canvas"),s=this.project.get(),i=s.nodes.get(t),n=s.trees.getSelected();if(i){var a=new b3e.Block(i);a._applySettings(this._settings),a.x=a._width,a.y=a._height,e.setAttribute("width",a._width*n.scaleX*2),e.setAttribute("height",a._height*n.scaleY*2);var r=new createjs.Stage(e);return r.scaleX=n.scaleX,r.scaleY=n.scaleY,r.addChild(a),r.update(),e}},e.isDirty=function(){return 0!==this._dirty},e.clearDirty=function(){this._dirty=0},b3e.editor.Editor=createjs.promote(t,"Container")}();
!function(){"use strict";var e=function(e){this.Container_constructor(),this._id=b3.createUUID(),this._editor=e,this._selectedTree=null,this._clipboard=null,this._nodes={},this.trees=null,this.nodes=null,this.history=null,this._initialize()},t=createjs.extend(e,createjs.Container);t._initialize=function(){this.trees=new b3e.project.TreeManager(this._editor,this),this.nodes=new b3e.project.NodeManager(this._editor,this),this.history=new b3e.project.HistoryManager(this._editor,this);var e=[{name:"root",category:"root",title:"My tree",description:'The root of this tree.  The title of this node sets the title of the tree.  You must have one tree called "Root".  You can set tree-wide properties on this node and reference them in other places with the following template syntax: `{{key_name}}`.'},{name:"sequence",category:"composite",title:"Sequence",description:"Takes multiple children and runs them from top to bottom (or left to right).  If any fail, this node fails, if all succeed, this node succeeds."},{name:"select",category:"composite",title:"Select",description:"Takes multiple children and runs them from top to bottom (or left to right), succeeding when any one succeeds.  Fails if all fail."},{name:"random",category:"composite",title:"Random",description:"Takes multiple children and runs one of them at random."},{name:"random_weighted",category:"composite",title:"Random weighted",description:'Takes multiple children and runs one of them at random based on their weightings.  Each child node MUST have a "weight" property with a value greater than 0.'},{name:"repeat_n",category:"decorator",title:"Repeat <n>x",description:'Takes one child and runs it "n" times, where "n" is defined in this node\'s properties.',properties:{n:2}},{name:"repeat_until_fail",category:"decorator",title:"Repeat until fail",description:"Takes one child which it repeats until it fails.  This node always succeeds."},{name:"repeat_until_succeed",category:"decorator",title:"Repeat until succeed",description:"Takes one child which it repeats until it succeeds.  This node always succeeds."},{name:"negate",category:"decorator",title:"Negate",description:"Takes one child.  If that child succeeds, this node fails, and vice versa."},{name:"always_fail",category:"decorator",title:"Always fail",description:"Takes one child and fails regardless of its outcome."},{name:"always_succeed",category:"decorator",title:"Always succeed",description:"Takes one child and succeeds regardless of its outcome."},{name:"runner",category:"action",title:"Module.function(1, 2, 3)",description:'An action that calls the function specified in the title (must be in valid Elixir terms).  The title can contain "template variables" (like `{{mod}}.rename({{new_name}}, true)`) which will be replaced with corresponding values looked up on the parent tree.'},{name:"wait",category:"action",title:"wait(1)",description:'"Pauses" the bot for the specified number of seconds.  You can specify two numbers (like `wait(1,10)`) to wait a random number of seconds between those numbers.'},{name:"error",category:"action",title:'error("Oops...")',description:"Raises an error with the supplied message."},{name:"log",category:"action",title:'log("Info...")',description:"Logs the specified message."},{name:"succeed_rate",category:"action",title:"succeed_rate(0.5)",description:"Succeeds randomly at the specified rate, expressed as a number between 0 and 1.  For example, a rate of 0.25 will succeed one out of every 4 times on average."},{name:"done",category:"action",title:"done()",description:"Stops the behavior tree."}];e.forEach(function(e){this.nodes.add(e,!0)},this),this._applySettings(this._editor._settings),this.history.clear(),this._editor.clearDirty()},t._applySettings=function(e){this.trees._applySettings(e),this.nodes._applySettings(e),this.history._applySettings(e)},b3e.project.Project=createjs.promote(e,"Container")}();
!function(){"use strict";var t=function(t,e){this.Container_constructor(),this._id=b3.createUUID(),this._editor=t,this._project=e,this._selectedBlocks=[],this._selectionBox=null,this._root=null,this._blocks=new createjs.Container,this._connections=new createjs.Container,this._overlay=new createjs.Container,this.blocks=null,this.connections=null,this.edit=null,this.selection=null,this.view=null,this.organizer=null,this._initialize()},e=createjs.extend(t,createjs.Container);e._initialize=function(){this.blocks=new b3e.tree.BlockManager(this._editor,this._project,this),this.connections=new b3e.tree.ConnectionManager(this._editor,this._project,this),this.edit=new b3e.tree.EditManager(this._editor,this._project,this),this.selection=new b3e.tree.SelectionManager(this._editor,this._project,this),this.view=new b3e.tree.ViewManager(this._editor,this._project,this),this.organize=new b3e.tree.OrganizeManager(this._editor,this._project,this),this.addChild(this._connections),this.addChild(this._blocks),this.addChild(this._overlay),this._selectionBox=new b3e.SelectionBox,this._overlay.addChild(this._selectionBox),this._root=this.blocks.add("root",0,0),this._applySettings(this._editor._settings),this.view.center()},e._applySettings=function(t){this._selectionBox._applySettings(t),this.blocks._applySettings(t),this.connections._applySettings(t),this.edit._applySettings(t),this.selection._applySettings(t),this.view._applySettings(t),this.organize._applySettings(t)},b3e.tree.Tree=createjs.promote(t,"Container")}();
b3e.editor.ExportManager=function(e){"use strict";function t(t){var o=t._outConnections.slice(0);"horizontal"===e._settings.get("layout")?o.sort(function(e,t){return e._outBlock.y-t._outBlock.y}):o.sort(function(e,t){return e._outBlock.x-t._outBlock.x});for(var r=[],i=0;i<o.length;i++)r.push(o[i]._outBlock.id);return r}this.projectToData=function(){var t=e.project.get();if(t){var o=t.trees.getSelected(),r={version:b3e.VERSION,scope:"project",selectedTree:o?o._id:null,trees:[],custom_nodes:this.nodesToData()};return t.trees.each(function(e){var t=this.treeToData(e,!0);t.id=e._id,r.trees.push(t)},this),r}},this.treeToData=function(o,r){var i=e.project.get();if(i){if(o){if(o=i.trees.get(o),!o)return}else o=i.trees.getSelected();var s=o.blocks.getRoot(),n=t(s),c={version:b3e.VERSION,scope:"tree",id:o._id,title:s.title,description:s.description,root:n[0]||null,properties:s.properties,nodes:{},display:{camera_x:o.x,camera_y:o.y,camera_z:o.scaleX,x:s.x,y:s.y}};return r||(c.custom_nodes=this.nodesToData()),o.blocks.each(function(e){if("root"!==e.category){var o={id:e.id,name:e.name,title:e.title,description:e.description,properties:e.properties,display:{x:e.x,y:e.y}},r=t(e);"composite"===e.category?o.children=r:"decorator"===e.category&&(o.child=r[0]),c.nodes[e.id]=o}}),c}},this.nodesToData=function(){var t=e.project.get();if(t){var o=[];return t.nodes.each(function(e){e.isDefault||o.push({version:b3e.VERSION,scope:"node",name:e.name,category:e.category,title:e.title,description:e.description,properties:e.properties})}),o}},this.nodesToJavascript=function(){},this._applySettings=function(e){}};
b3e.editor.ImportManager=function(e){"use strict";this.projectAsData=function(t){var r=e.project.get();r&&(t.custom_nodes&&this.nodesAsData(t.custom_nodes),t.trees&&this.treesAsData(t.trees),t.selectedTree&&r.trees.select(t.selectedTree),e.trigger("projectimported"))},this.treeAsData=function(t){var r=e.project.get();if(r){var o=r.trees.get(t.id),s=o.blocks.getRoot(),i=null,a=t.display||{};o.x=a.camera_x||0,o.y=a.camera_y||0,o.scaleX=a.camera_z||1,o.scaleY=a.camera_z||1;var n=r.nodes.get(o._id);n.title=t.title,s.title=t.title,s.description=t.description,s.properties=t.properties,s.x=a.x||0,s.y=a.y||0,t.custom_nodes&&this.nodesAsData(t.custom_nodes);var c,d;for(c in t.nodes){d=t.nodes[c];var l=null;a=d.display||{},l=o.blocks.add(d.name,d.display.x,d.display.y),l.id=d.id,l.title=d.title,l.description=d.description,l.properties=tine.merge({},l.properties,d.properties),l._redraw(),d.id===t.root&&(i=l)}for(c in t.nodes){d=t.nodes[c];var p=o.blocks.get(c),g=null;if("composite"===p.category&&d.children?g=d.children:!d.child||"decorator"!=p.category&&"root"!=p.category||(g=[d.child]),g)for(var h=0;h<g.length;h++){var f=o.blocks.get(g[h]);o.connections.add(p,f)}}i&&o.connections.add(s,i),t.display||o.organize.organize(!0),o.selection.deselectAll(),o.selection.select(s),r.history.clear(),e.trigger("treeimported")}},this.treesAsData=function(t){var r=e.project.get();t.forEach(function(e){r.trees.add(e.id)});for(var o=0;o<t.length;o++)this.treeAsData(t[o])},this.nodesAsData=function(t){var r=e.project.get();if(r){for(var o=0;o<t.length;o++){var s=t[o];r.nodes.add(s)}e.trigger("nodeimported")}},this._applySettings=function(e){}};
b3e.editor.ProjectManager=function(e){"use strict";this.create=function(){this.close();var t=new b3e.project.Project(e);e.addChild(t),e._project=t,e.trigger("projectcreated",e._project),e._project.trees.add()},this.open=function(t){this.close();var r=new b3e.project.Project(e);e.addChild(r),e._project=r,e["import"].projectAsData(t),e.trigger("projectopened",e._project),e.clearDirty()},this.close=function(){var t=e._project;t&&(e.removeChild(t),e.trigger("projectclosed",t))},this.get=function(){return e._project},this._applySettings=function(t){e._project&&e._project._applySettings(t)}};
b3e.editor.ShortcutManager=function(t){"use strict";this._applySettings=function(t){}};
b3e.editor.CameraSystem=function(e){"use strict";var t=!1,s=0,a=0;this.update=function(t){var s=e.project.get();if(s){var a=s.trees.getSelected();if(a){var n=e._game.keyboard,o=tine.keys;n.isDown(o.CTRL)?n.isPressed(o.UP)||n.isPressed(o.EQUAL)?a.view.zoomIn():(n.isPressed(o.DOWN)||n.isPressed(o.DASH))&&a.view.zoomOut():(n.isDown(o.LEFT)?a.x+=t:n.isDown(o.RIGHT)&&(a.x-=t),n.isDown(o.UP)?a.y+=t:n.isDown(o.DOWN)&&(a.y-=t))}}},this.onMouseDown=function(n){var o=2===n.nativeEvent.which,i=1===n.nativeEvent.which&&n.nativeEvent.shiftKey;if(o||i){var v=e.project.get();if(v){var r=v.trees.getSelected();r&&(e._game.canvas.className+=" grabbing",t=!0,s=e._game.mouse.x-r.x,a=e._game.mouse.y-r.y)}}},this.onMouseMove=function(n){if(t){var o=e.project.get();if(o){var i=o.trees.getSelected();i&&(i.x=e._game.mouse.x-s,i.y=e._game.mouse.y-a)}}},this.onMouseUp=function(n){var o=2===n.nativeEvent.which,i=1===n.nativeEvent.which&&n.nativeEvent.shiftKey;if(o||i){var v=e.project.get();if(v){var r=v.trees.getSelected();r&&(e._game.canvas.className=e._game.canvas.className.replace(/(?:^|\s)grabbing(?!\S)/g,""),t=!1,s=0,a=0)}}},this.onMouseWheel=function(t){var s=e.project.get();if(s){var a=s.trees.getSelected();a&&t.ctrlKey&&((t.wheelDeltaY||t.deltaY)>0?a.view.zoomIn():a.view.zoomOut())}};var n=this;e._game.stage.on("stagemousedown",this.onMouseDown,this),e._game.stage.on("stagemousemove",this.onMouseMove,this),e._game.stage.on("stagemouseup",this.onMouseUp,this),e._game.canvas.addEventListener("wheel",function(e){n.onMouseWheel(e)},!1),e._game.canvas.addEventListener("mousewheel",function(e){n.onMouseWheel(e)},!1),e._game.canvas.addEventListener("DOMMouseScroll ",function(e){n.onMouseWheel(e)},!1)};
b3e.editor.CollapseSystem=function(t){"use strict";this.update=function(t){}};
b3e.editor.ConnectionSystem=function(n){"use strict";var o=null,e=null;this.update=function(n){},this.onMouseDown=function(t){if(1===t.nativeEvent.which){var i=n.project.get();if(i){var c=i.trees.getSelected();if(c){var s=c.view.getLocalPoint(),r=s.x,a=s.y,l=c.blocks.getUnderPoint(r,a);if(!o&&l)if(l._hitOutAnchor(r,a))o=c.connections.add(l,null);else if(l._hitInAnchor(r,a)){var u=l._inConnection;if(!u)return;l._inConnection=null,u._outBlock=null,e=l,o=u}}}}},this.onMouseMove=function(e){if(o){var t=n.project.get();if(t){var i=t.trees.getSelected();if(i){var c=i.view.getLocalPoint(),s=c.x,r=c.y;o._redraw(null,null,s,r)}}}},this.onMouseUp=function(t){if(1===t.nativeEvent.which&&o){var i=n.project.get();if(i){var c=i.trees.getSelected();if(c){var s=c.view.getLocalPoint(),r=s.x,a=s.y,l=c.blocks.getUnderPoint(r,a);if(i.history._beginBatch(),l&&l!==o._inBlock&&"root"!==l.category){var u;l._inConnection&&(u=l._inConnection,c.connections.remove(u)),("root"===o._inBlock.category||"decorator"===o._inBlock.category)&&o._inBlock._outConnections.length>1&&(u=o._inBlock._outConnections[0],c.connections.remove(u)),o._outBlock=l,l._inConnection=o;var _=[c.connections,c.connections._remove,[l]],v=[c.connections,c.connections.add,[o._inBlock,l]];i.history._add(new b3e.Command(_,v)),o._redraw()}else e&&(e._inConnection=o,o._outBlock=e),c.connections.remove(o);i.history._endBatch(),o=null}}}},n._game.stage.on("stagemousedown",this.onMouseDown,this),n._game.stage.on("stagemousemove",this.onMouseMove,this),n._game.stage.on("stagemouseup",this.onMouseUp,this)};
b3e.editor.DragSystem=function(e){"use strict";var t=!1,o=0,s=0;this.update=function(e){},this.onMouseDown=function(n){if(1===n.nativeEvent.which&&!n.nativeEvent.ctrlKey&&!t){var i=e.project.get();if(i){var a=i.trees.getSelected();if(a){var r=a.view.getLocalPoint(),c=r.x,g=r.y,f=a.blocks.getUnderPoint(c,g);if(f&&f._isSelected&&f._hitBody(c,g)){t=!0,o=c,s=g;for(var _=0;_<a._selectedBlocks.length;_++)f=a._selectedBlocks[_],f._isDragging=!0,f._dragOffsetX=c-f.x,f._dragOffsetY=g-f.y}}}}},this.onMouseMove=function(o){if(t){var s=e.project.get();if(s){var n=s.trees.getSelected();if(n)for(var i=n.view.getLocalPoint(),a=i.x,r=i.y,c=0;c<n._selectedBlocks.length;c++){var g=n._selectedBlocks[c],f=a-g._dragOffsetX,_=r-g._dragOffsetY;g.x=f,g.y=_,g._snap(),g._inConnection&&g._inConnection._redraw();for(var v=0;v<g._outConnections.length;v++)g._outConnections[v]._redraw()}}}},this.onMouseUp=function(n){if(1===n.nativeEvent.which&&t){var i=e.project.get();if(i){var a=i.trees.getSelected();if(a){t=!1;var r=a.view.getLocalPoint();r.x,r.y;i.history._beginBatch();for(var c=0;c<a._selectedBlocks.length;c++){var g=a._selectedBlocks[c];g._isDragging=!1;var f=[g,o-g._dragOffsetX,s-g._dragOffsetY],_=[g,g.x,g.y];if(f[1]===_[1]&&f[2]===_[2])break;i.history._add(new b3e.Command([a.blocks,a.blocks._move,f],[a.blocks,a.blocks._move,_]))}i.history._endBatch()}}}},e._game.stage.on("stagemousedown",this.onMouseDown,this),e._game.stage.on("stagemousemove",this.onMouseMove,this),e._game.stage.on("stagemouseup",this.onMouseUp,this)};
b3e.editor.SelectionSystem=function(e){"use strict";var t=!1,i=!1,o=!1,s=!1,n=0,c=0;this.update=function(e){},this.onMouseDown=function(a){var l=e.project.get();if(l){var v=l.trees.getSelected();if(v&&1===a.nativeEvent.which){i=a.nativeEvent.ctrlKey,o=a.nativeEvent.shiftKey,s=a.nativeEvent.altKey;var r=v.view.getLocalPoint(),h=r.x,u=r.y,g=v.blocks.getUnderPoint(h,u);g&&g._isSelected&&i?s?v.selection.deselectSubtree(g):v.selection.deselect(g):g&&!g._isSelected&&g._hitBody(h,u)?(i||v.selection.deselectAll(),s?v.selection.selectSubtree(g):v.selection.select(g)):g&&g._hitBody(h,u)?s&&v.selection.selectSubtree(g):g||(t=!0,n=h,c=u,i||v.selection.deselectAll())}}},this.onMouseMove=function(i){if(t){var o=e.project.get();if(o){var s=o.trees.getSelected();if(s){var a=s.view.getLocalPoint(),l=a.x,v=a.y;s._selectionBox.visible=!0,s._selectionBox._redraw(n,c,l,v)}}}},this.onMouseUp=function(i){if(1===i.nativeEvent.which&&t){var o=e.project.get();if(o){var s=o.trees.getSelected();if(s){var a=s.view.getLocalPoint(),l=a.x,v=a.y,r=Math.min(n,l),h=Math.min(c,v),u=Math.max(n,l),g=Math.max(c,v);s.blocks.each(function(e){e._isContainedIn(r,h,u,g)&&s.selection.select(e)}),s._selectionBox.visible=!1,t=!1}}}},e._game.stage.on("stagemousedown",this.onMouseDown,this),e._game.stage.on("stagemousemove",this.onMouseMove,this),e._game.stage.on("stagemouseup",this.onMouseUp,this)};
b3e.editor.ShortcutSystem=function(e){"use strict";this.update=function(t){var i=e.project.get();if(i){var r=i.trees.getSelected();if(r){e._game.keyboard,tine.keys}}}};
b3e.project.HistoryManager=function(t,n){"use strict";var e=[],i=0,c=0,s=0,o=[];this.clear=function(){e=[],i=0},this.undo=function(){this._lock(),this.canUndo()&&(i--,e[i].undo(),n.trees.select(e[i].context)),this._unlock(),t._dirty--},this.redo=function(){this._lock(),this.canRedo()&&(e[i].redo(),n.trees.select(e[i].context),i++),this._unlock(),t._dirty++},this.canUndo=function(){return i>0},this.canRedo=function(){return i<e.length},this._add=function(h,r){if(!(c>0)){e.length>i&&e.splice(i,e.length-i),s>0?o.push(h):(i++,h.context=n.trees.getSelected(),e.push(h),t._dirty<0&&(t._dirty=0),t._dirty++);var l=t._settings.get("max_history");e.length>l&&e.splice(0,1)}},this._lock=function(){c++},this._unlock=function(){c--},this._beginBatch=function(){s++},this._endBatch=function(){if(s=Math.max(0,s-1),0===s){if(o.length>0){var t=new b3e.Commands(o);t.context=n.trees.getSelected(),this._add(t)}o=[]}},this._applySettings=function(t){var n=t.get("max_history");e.length>n&&e.splice(0,e.length-n)}};
b3e.project.NodeManager=function(e,t){"use strict";this.add=function(n,i){if(n.prototype&&(n=n.prototype),t._nodes[n.name])return!1;if(!(n instanceof b3e.Node)){var r=new b3e.Node(i);r.name=n.name,r.category=n.category,r.title=n.title,r.description=n.description,r.properties=tine.merge({},n.properties||n.parameters),n=r}t._nodes[n.name]=n,i!==!0&&e.trigger("nodeadded",n);var o=[this,this.remove,[n]],a=[this,this.add,[n]];return t.history._add(new b3e.Command(o,a)),n},this.get=function(e){return"string"!=typeof e?e:t._nodes[e]},this.update=function(n,i){n=this.get(n);var r=n.name;if(delete t._nodes[n.name],n.name!==i.name&&this.get(i.name))return!1;var o={name:n.name,title:n.title,description:n.description,category:n.category,properties:n.properties};"undefined"!=typeof i.name&&(n.name=i.name),"undefined"!=typeof i.title&&(n.title=i.title),"undefined"!=typeof i.category&&(n.category=i.category),"undefined"!=typeof i.description&&(n.description=i.description),"undefined"!=typeof i.properties&&(n.properties=tine.merge({},i.properties));var a={name:n.name,title:n.title,description:n.description,category:n.category,properties:n.properties};t.history._beginBatch(),t.trees.each(function(e){for(var t=e.blocks.getAll(),n=t.length-1;n>=0;n--)t[n].name===r&&e.blocks.update(t[n])}),t._nodes[n.name]=n;var s=[this,this.update,[n,o]],d=[this,this.update,[n,a]];t.history._add(new b3e.Command(s,d)),t.history._endBatch(),e.trigger("nodechanged",n)},this.remove=function(n){t.history._beginBatch();var i=n.name||n;delete t._nodes[i],t.trees.each(function(e){for(var t=e.blocks.getAll(),n=t.length-1;n>=0;n--)t[n].name===i&&e.blocks.remove(t[n])});var r=[this,this.add,[n]],o=[this,this.remove,[n]];t.history._add(new b3e.Command(r,o)),t.history._endBatch(),e.trigger("noderemoved",n)},this.each=function(e,n){Object.keys(t._nodes).forEach(function(i){e.call(n,t._nodes[i])})},this._applySettings=function(e){}};
b3e.project.TreeManager=function(e,t){"use strict";this.add=function(i){var r;if(i instanceof b3e.tree.Tree)r=i,t.addChild(r),e.trigger("treeadded",r),this.select(r);else{t.history._beginBatch(),r=new b3e.tree.Tree(e,t);var d=r.blocks.getRoot();t.addChild(r),e.trigger("treeadded",r),i&&(r._id=i);var n={name:r._id,title:d.title,category:"tree",description:"An instance of the tree.  You can add properties to this node and they will be available in action nodes in this tree (using syntax like `{{key}}`).  Properties defined on this node will overwrite the same property defined on the tree's root node."};t.nodes.add(n,!0),this.select(r);var s=[this,this.remove,[r]],h=[this,this.add,[r]];t.history._add(new b3e.Command(s,h)),t.history._endBatch()}return r},this.get=function(e){if("string"==typeof e){for(var i=0;i<t.children.length;i++)if(t.children[i]._id===e)return t.children[i];return void 0}return e},this.getSelected=function(){return t._selectedTree},this.select=function(i){i=this.get(i),!i||t.getChildIndex(i)<0||t._selectedTree!==i&&(t._selectedTree&&(t._selectedTree.visible=!1,e.trigger("treedeselected",t._selectedTree)),i.visible=!0,t._selectedTree=i,e.trigger("treeselected",i))},this.remove=function(i){t.history._beginBatch(),i=this.get(i);var r=t.children.indexOf(i);t.removeChild(i),t.nodes.remove(i._id),e.trigger("treeremoved",i),0===t.children.length?this.add():i===t._selectedTree&&this.select(0===r?t.children[r]:t.children[r-1]);var d=[this,this.add,[i]],n=[this,this.remove,[i]];t.history._add(new b3e.Command(d,n)),t.history._endBatch()},this.each=function(e,i){t.children.forEach(e,i)},this._applySettings=function(e){this.each(function(t){t._applySettings(e)})}};
b3e.tree.BlockManager=function(e,t,n){"use strict";this._move=function(e,t,n){e.x=t,e.y=n,e._redraw(),e._inConnection&&e._inConnection._redraw();for(var i=0;i<e._outConnections.length;i++)e._outConnections[i]._redraw()},this.add=function(i,o,r){var s;if(i instanceof b3e.Block)s=i,s._snap(),n._blocks.addChild(s),e.trigger("blockadded",s);else{o=o||0,r=r||0;var c=i;"string"==typeof i&&(c=t.nodes.get(i)),s=new b3e.Block(c),s._applySettings(e._settings),s.x=o,s.y=r,s._snap(),n._blocks.addChild(s),n.selection.deselectAll(),n.selection.select(s),e.trigger("blockadded",s)}var d=[this,this.remove,[s]],a=[this,this.add,[s,s.x,s.y]];return t.history._add(new b3e.Command(d,a)),s},this.get=function(e){if("string"==typeof e){for(var t=n._blocks.children,i=0;i<t.length;i++)if(t[i].id===e)return t[i];return void 0}return e},this.getUnderPoint=function(e,t){if(!e||!t){var i=n.view.getLocalPoint();e=i.x,t=i.y}for(var o=this.getAll(),r=o.length-1;r>=0;r--){var s=o[r];if(s._hitTest(e,t))return s}},this.getSelected=function(){return n._selectedBlocks.slice()},this.getAll=function(){return n._blocks.children},this.getRoot=function(){return n._root},this.update=function(n,i,o){var r=!!i,s={name:n.name,title:n.title,description:n.description,properties:n.properties};i=i||{};var c=n.node;"undefined"!=typeof i.name?n.name=i.name:n.name=n.name||c.name,"undefined"!=typeof i.title?n.title=i.title:n.title=n.title||c.title,"undefined"!=typeof i.description?n.description=i.description:n.description=n.description||c.description,"undefined"!=typeof i.properties&&(n.properties=tine.merge({},c.properties,i.properties)),n._redraw();var d={name:n.name,title:n.title,description:n.description,properties:n.properties};n._inConnection&&n._inConnection._redraw();for(var a=0;a<n._outConnections.length;a++)n._outConnections[a]._redraw();r||t.history._lock(),t.history._beginBatch();var l=[this,this.update,[n,s]],h=[this,this.update,[n,d]];t.history._add(new b3e.Command(l,h)),t.history._endBatch(),r||t.history._unlock(),e.trigger("blockchanged",n)},this.remove=function(i){if(t.history._beginBatch(),n._blocks.removeChild(i),i._inConnection&&n.connections.remove(i._inConnection),i._outConnections.length>0)for(var o=i._outConnections.length-1;o>=0;o--)n.connections.remove(i._outConnections[o]);i._isSelected&&n.selection.deselect(i);var r=[this,this.add,[i,i.x,i.y]],s=[this,this.remove,[i]];t.history._add(new b3e.Command(r,s)),t.history._endBatch(),e.trigger("blockremoved",i)},this.cut=function(i){if(t.history._beginBatch(),n._blocks.removeChild(i),i._inConnection&&(i._inConnection._outBlock._isSelected?i._inConnection.visible=!1:n.connections.remove(i._inConnection)),i._outConnections.length>0)for(var o=i._outConnections.length-1;o>=0;o--)i._outConnections[o]._inBlock._isSelected?i._outConnections[o].visible=!1:n.connections.remove(i._outConnections[o]);var r=[this,this.add,[i,i.x,i.y]],s=[this,this.remove,[i]];t.history._add(new b3e.Command(r,s)),e.trigger("blockremoved",i),t.history._endBatch()},this.each=function(e,t){n._blocks.children.forEach(e,t)},this._applySettings=function(e){this.each(function(t){t._applySettings(e)})}};
b3e.tree.ConnectionManager=function(n,o,t){"use strict";this._remove=function(n){o.history._lock(),this.remove(n._inConnection),o.history._unlock()},this.add=function(i,e){var c=new b3e.Connection;if(i&&(c._inBlock=i,i._outConnections.push(c),n.trigger("blockconnected",i,{connection:c,type:"outConnection",other:e})),e&&(c._outBlock=e,e._inConnection=c,n.trigger("blockconnected",e,{connection:c,type:"inConnection",other:i})),i&&e){var s=[this,this._remove,[e]],_=[this,this.add,[i,e]];o.history._add(new b3e.Command(s,_))}return c._applySettings(n._settings),t._connections.addChild(c),c},this.remove=function(i){if(i._inBlock&&i._outBlock){var e=[this,this.add,[i._inBlock,i._outBlock]],c=[this,this._remove,[i._outBlock]];o.history._add(new b3e.Command(e,c))}i._inBlock&&(i._inBlock._outConnections.remove(i),i._inBlock=null),i._outBlock&&(i._outBlock._inConnection=null,i._outBlock=null),t._connections.removeChild(i),n.trigger("connectionremoved",i)},this.each=function(n,o){t._connections.children.forEach(n,o)},this._applySettings=function(n){this.each(function(o){o._applySettings(n)})}};
b3e.tree.EditManager=function(o,e,t){"use strict";this._selectionToClipboard=function(){var o,n,c,i,s={blocks:{},connections:[]},l=t._selectedBlocks;for(o=0;o<l.length;o++)if(c=l[o],"root"!==c.category){var r={};r.id=c.id,r.node=c.node,r.name=c.name,r.title=c.title,r.category=c.category,r.description=c.description,r.properties=c.properties,r._settings=c._settings,r.x=c.x,r.y=c.y,s.blocks[c.id]=r}for(o=0;o<l.length;o++)if(c=l[o],"root"!==c.category)for(n=0;n<c._outConnections.length;n++)i=c._outConnections[n]._outBlock,s.blocks[i.id]&&s.connections.push([c.id,i.id]);e._clipboard=s},this.copy=function(){this._selectionToClipboard()},this.cut=function(){this._selectionToClipboard(),e.history._beginBatch();for(var o=t._selectedBlocks.length-1;o>=0;o--){var n=t._selectedBlocks[o];"root"!=n.category&&t.blocks.remove(t._selectedBlocks[o])}e.history._endBatch(),t._selectedBlocks=[],console.log(e._clipboard)},this.paste=function(){if(null!==e._clipboard){var o,n={},c=[];e.history._beginBatch();for(var i in e._clipboard.blocks){var s=e._clipboard.blocks[i],l=new b3e.Block(s);s.x+=50,s.y+=50,l._applySettings(s._settings),l.x=s.x,l.y=s.y,t.blocks.add(l),n[i]=l,c.push(l)}for(o=0;o<e._clipboard.connections.length;o++){var r=e._clipboard.connections[o],a=n[r[0]],_=n[r[1]];t.connections.add(a,_)}for(t.selection.deselectAll(),o=0;o<c.length;o++)t.selection.select(c[o]);e.history._endBatch()}},this.duplicate=function(){e.history._beginBatch();var o=e._clipboard;this.copy(),this.paste(),e._clipboard=o,e.history._endBatch()},this.remove=function(){e.history._beginBatch();for(var o=null,n=t._selectedBlocks.length-1;n>=0;n--)"root"===t._selectedBlocks[n].category?o=t._selectedBlocks[n]:t.blocks.remove(t._selectedBlocks[n]);e.history._endBatch()},this.removeConnections=function(){e.history._beginBatch();for(var o=0;o<t._selectedBlocks.length;o++){var n=t._selectedBlocks[o];if(n._inConnection&&t.connections.remove(n._inConnection),n._outConnections.length>0)for(var c=n._outConnections.length-1;c>=0;c--)t.connections.remove(n._outConnections[c])}e.history._endBatch()},this.removeInConnections=function(){e.history._beginBatch();for(var o=0;o<t._selectedBlocks.length;o++){var n=t._selectedBlocks[o];n._inConnection&&t.connections.remove(n._inConnection)}e.history._endBatch()},this.removeOutConnections=function(){e.history._beginBatch();for(var o=0;o<t._selectedBlocks.length;o++){var n=t._selectedBlocks[o];if(n._outConnections.length>0)for(var c=n._outConnections.length-1;c>=0;c--)t.connections.remove(n._outConnections[c])}e.history._endBatch()},this._applySettings=function(o){}};
b3e.tree.OrganizeManager=function(o,t,n){"use strict";function e(o){var t,n;if(g.push(o),0===o._outConnections.length)i++,t=u*c,n=i*l;else{var r,s=0;h?r=o._outConnections:(r=o._outConnections.slice(0),r.sort(function(o,t){return o._outBlock.y-t._outBlock.y}));for(var a=0;a<r.length;a++)u++,_.push(r[a]),s+=e(r[a]._outBlock),u--;t=u*c,n=s/o._outConnections.length}return o.x=t,o.y=n,n}function r(o){var t,n;if(g.push(o),0===o._outConnections.length)i++,t=i*c,n=u*(l+a);else{var e,s=0;h?e=o._outConnections:(e=o._outConnections.slice(0),e.sort(function(o,t){return o._outBlock.x-t._outBlock.x}));for(var f=0;f<e.length;f++)u++,_.push(e[f]),s+=r(e[f]._outBlock),u--;t=s/o._outConnections.length,n=u*(l+a)}return o.x=t,o.y=n,t}var s=null,u=0,i=0,c=208,l=88,a=42,h=!1,_=[],g=[];this.organize=function(s,c){s=s||n.blocks.getRoot(),u=0,i=0,_=[],g=[],h=h;var l=s.x,a=s.y,f=[];s.traversal(function(o){f.push([o,o.x,o.y])}),"horizontal"===o._settings.get("layout")?e(s):r(s),l-=s.x,a-=s.y;var v;for(v=0;v<g.length;v++)g[v].x+=l,g[v].y+=a,g[v]._snap();for(v=0;v<_.length;v++)_[v]._redraw();var y=[];for(s.traversal(function(o){y.push([o,o.x,o.y])}),t.history._beginBatch(),v=0;v<g.length;v++){var k=[n.blocks,n.blocks._move,f[v]],p=[n.blocks,n.blocks._move,y[v]];t.history._add(new b3e.Command(k,p))}t.history._endBatch()},this._applySettings=function(o){var t=o.get("layout");s&&t!==s&&this.organize(),s=t}};
b3e.tree.SelectionManager=function(e,t,s){"use strict";this.select=function(t){t._isSelected||(t._select(),s._selectedBlocks.push(t),e.trigger("blockselected",t))},this.deselect=function(t){t._isSelected&&(t._deselect(),s._selectedBlocks.remove(t),e.trigger("blockdeselected",t))},this.selectAll=function(){s.blocks.each(function(e){this.select(e)},this)},this.deselectAll=function(){for(var e=s._selectedBlocks.length-1;e>=0;e--)this.deselect(s._selectedBlocks[e])},this.invertSelection=function(e){var t=e?[e]:s.blocks.getAll();t.forEach(function(e){e._isSelected?this.deselect(e):this.select(e)},this)},this.selectSubtree=function(e){for(var t=e?[e]:s._selectedBlocks,c=function(e){t.remove(e),this.select(e)};t.length>0;)t.pop().traversal(c,this)},this.deselectSubtree=function(e){for(var t=e?[e]:s._selectedBlocks,c=function(e){t.remove(e),this.deselect(e)};t.length>0;)t.pop().traversal(c,this)},this._applySettings=function(e){}};
b3e.tree.ViewManager=function(t,e,i){"use strict";this.reset=function(){i.x=0,i.y=0,i.scaleX=1,i.scaleY=1},this.zoom=function(t){i.scaleX=t,i.scaleY=t},this.zoomIn=function(){var e=t._settings.get("zoom_min"),n=t._settings.get("zoom_max"),o=t._settings.get("zoom_step"),s=i.scaleX;this.zoom(tine.clip(s+o,e,n))},this.zoomOut=function(){var e=t._settings.get("zoom_min"),n=t._settings.get("zoom_max"),o=t._settings.get("zoom_step"),s=i.scaleX;this.zoom(tine.clip(s-o,e,n))},this.pan=function(t,e){i.x+=t,i.y+=e},this.setCam=function(t,e){i.x=t,i.y=e},this.center=function(){var e=t._game.canvas,i=e.width/2,n=e.height/2;this.setCam(i,n)},this.getLocalPoint=function(e,n){return"undefined"==typeof e&&(e=t._game.mouse.x),"undefined"==typeof n&&(n=t._game.mouse.y),i.globalToLocal(e,n)},this._applySettings=function(t){}};
angular.module("app",["ui.router","ui.bootstrap","ngAnimate","templates"]).run(["$rootScope","$window","$state",function(e,t,n){e.isDesktop=!!t.process&&!!t.require,e.go=function(e,t){n.go(e,t)}}]).run(["$window","$animate","$location","$document","$timeout","settingsModel","projectModel",function(e,t,n,o,a,r,c){n.path("/"),angular.element(e.editor._game.canvas).attr("b3-drop-node",!0),r.getSettings(),c.getRecentProjects().then(function(e){function n(){a(function(){var e=angular.element(document.getElementById("page-preload"));t.addClass(e,"preload-fade").then(function(){e.remove()})},500)}e.length>0&&e[0].isOpen?c.openProject(e[0].path).then(function(){n()})["catch"](function(e){console.error(e),n()}):n()})["catch"](function(e){console.error(e),closePreload()})}]);
angular.module("app").config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/dash/home"),t.state("dash",{url:"/dash","abstract":!0,templateUrl:"pages/dash/dash.html",controller:"DashController",controllerAs:"dash"}).state("dash.home",{url:"/home",templateUrl:"pages/home/home.html",controller:"HomeController",controllerAs:"home"}).state("dash.projects",{url:"/projects",templateUrl:"pages/projects/projects.html",controller:"ProjectsController",controllerAs:"projects"}).state("dash.settings",{url:"/settings",templateUrl:"pages/settings/settings.html",controller:"SettingsController",controllerAs:"settings"}).state("editor",{url:"/editor",templateUrl:"pages/editor/editor.html",controller:"EditorController",controllerAs:"editor"}).state("editor.editnode",{url:"/node/:name",templateUrl:"pages/editor/modals/editnode.html",controller:"EditNodeController",controllerAs:"editnode"}).state("editor.export",{url:"/export/:type/:format",templateUrl:"pages/editor/modals/export.html",controller:"ExportController",controllerAs:"export"}).state("editor.import",{url:"/import/:type/:format",templateUrl:"pages/editor/modals/import.html",controller:"ImportController",controllerAs:"import"})}]);
!function(){"use strict";function o(o,n,i){function e(){window.onbeforeunload=t;try{var o=require("nw.gui"),n=o.Window.get();n.on("close",function(){r(n)})}catch(i){}}function t(){return n.editor.isDirty()?"Leaving now will erase your unsaved changes.":void 0}function r(o){return n.editor.isDirty()?(i.confirm("Leave without saving?","If you proceed you will lose all unsaved modifications.",null).then(function(){o.close(!0)}),!1):void o.close(!0)}e()}angular.module("app").controller("AppController",o),o.$inject=["$scope","$window","dialogService"]}();
!function(){"use strict";function n(n,t,o,e,r,i){function u(){}function c(t){return n.$$phase?g():n.$apply(function(){g()}),!1}function s(t){return n.$$phase?y():n.$apply(function(){y()}),!1}function a(){Mousetrap.bind("ctrl+q",c),Mousetrap.bind("ctrl+s",s),Mousetrap.bind("ctrl+z",$),Mousetrap.bind("ctrl+shift+z",C),Mousetrap.bind("ctrl+c",z),Mousetrap.bind("ctrl+v",P),Mousetrap.bind("ctrl+x",I),Mousetrap.bind("ctrl+d",x),Mousetrap.bind("del",w),Mousetrap.bind("a",O),Mousetrap.bind("ctrl+a",T),Mousetrap.bind("ctrl+shift+a",D),Mousetrap.bind("ctrl+i",N)}function d(){Mousetrap.unbind("ctrl+q",c),Mousetrap.unbind("ctrl+s",s),Mousetrap.unbind("ctrl+z",$),Mousetrap.unbind("ctrl+shift+z",C),Mousetrap.unbind("ctrl+c",z),Mousetrap.unbind("ctrl+v",P),Mousetrap.unbind("ctrl+x",I),Mousetrap.unbind("ctrl+d",x),Mousetrap.unbind("del",w),Mousetrap.unbind("a",O),Mousetrap.unbind("ctrl+a",T),Mousetrap.unbind("ctrl+shift+a",D),Mousetrap.unbind("ctrl+i",N)}function l(){return t.editor.project.get()}function p(){var n=t.editor.project.get();return n.trees.getSelected()}function f(){return o.go("editor.export",{type:"project",format:"json"}),!1}function v(){return o.go("editor.export",{type:"tree",format:"json"}),!1}function b(){return o.go("editor.export",{type:"nodes",format:"json"}),!1}function M(){return o.go("editor.import",{type:"project",format:"json"}),!1}function m(){return o.go("editor.import",{type:"tree",format:"json"}),!1}function j(){return o.go("editor.import",{type:"nodes",format:"json"}),!1}function g(){function n(){r.closeProject(),o.go("dash.projects")}return t.editor.isDirty()?e.confirm("Leave without saving?","If you proceed you will lose all unsaved modifications.",null).then(n):n(),!1}function y(){return r.saveProject().then(function(){i.success("Project saved","The project has been saved")},function(){i.error("Error","Project couldn't be saved")}),!1}function h(){var n=l();return n.trees.add(),!1}function $(){var n=l();return n.history.undo(),!1}function C(){var n=l();return n.history.redo(),!1}function z(){var n=p();return n.edit.copy(),!1}function I(){var n=p();return n.edit.cut(),!1}function P(){var n=p();return n.edit.paste(),!1}function x(){var n=p();return n.edit.duplicate(),!1}function w(){var n=p();return n.edit.remove(),!1}function S(){var n=p();return n.edit.removeConnections(),!1}function A(){var n=p();return n.edit.removeInConnections(),!1}function J(){var n=p();return n.edit.removeOutConnections(),!1}function O(){var n=p();return n.organize.organize(),!1}function R(){var n=p();return n.view.zoomIn(),!1}function E(){var n=p();return n.view.zoomOut(),!1}function T(){var n=p();return n.selection.selectAll(),!1}function D(){var n=p();return n.selection.deselectAll(),!1}function N(){var n=p();return n.selection.invertSelection(),!1}var q=this;q.onNewTree=h,q.onCloseProject=g,q.onSaveProject=y,q.onExportProjectJson=f,q.onExportTreeJson=v,q.onExportNodesJson=b,q.onImportProjectJson=M,q.onImportTreeJson=m,q.onImportNodesJson=j,q.onUndo=$,q.onRedo=C,q.onCopy=z,q.onCut=I,q.onPaste=P,q.onDuplicate=x,q.onRemove=w,q.onRemoveAllConns=S,q.onRemoveInConns=A,q.onRemoveOutConns=J,q.onAutoOrganize=O,q.onZoomIn=R,q.onZoomOut=E,q.onSelectAll=T,q.onDeselectAll=D,q.onInvertSelection=N,a(),u(),n.$on("$destroy",d)}angular.module("app").controller("MenubarController",n),n.$inject=["$scope","$window","$state","dialogService","projectModel","notificationService"]}();
!function(){"use strict";function e(e,o,t,r){function n(){l.trees=[],l.nodes={composite:[],decorator:[],action:[]};var e=o.editor.project.get();e.nodes.each(function(e){if("tree"!==e.category){var o=l.nodes[e.category];o&&o.push({name:e.name,title:a(e),isDefault:e.isDefault})}});var t=e.trees.getSelected();e.trees.each(function(e){var o=e.blocks.getRoot();l.trees.push({id:e._id,name:o.title||"My tree",active:e===t})})}function d(o){setTimeout(function(){e.$apply(function(){n()})},0)}function i(){o.editor.on("nodechanged",d),o.editor.on("noderemoved",d),o.editor.on("nodeadded",d),o.editor.on("treeadded",d),o.editor.on("blockchanged",d),o.editor.on("treeselected",d),o.editor.on("treeremoved",d),o.editor.on("treeimported",d)}function c(){o.editor.off("nodechanged",d),o.editor.off("noderemoved",d),o.editor.off("nodeadded",d),o.editor.off("treeadded",d),o.editor.off("blockchanged",d),o.editor.off("treeselected",d),o.editor.off("treeremoved",d),o.editor.off("treeimported",d)}function a(e){var o=e.title||e.name;return o=o.replace(/(<\w+>)/g,function(e,o){return"@"})}function f(){var e=o.editor.project.get();e.trees.add()}function s(e){var t=o.editor.project.get();t.trees.select(e)}function u(e){t.confirm("Remove tree?","Are you sure you want to remove this tree?\n\nNote: all blocks using this tree will be removed.").then(function(){var t=o.editor.project.get();t.trees.remove(e),r.success("Tree removed","The tree has been removed from this project.")})}var l=this;l.nodes=null,l.newTree=f,l.select=s,l.remove=u,i(),n(),e.$on("$destroy",c)}angular.module("app").controller("NodespanelController",e),e.$inject=["$scope","$window","dialogService","notificationService"]}();
!function(){"use strict";function e(e,o){function t(){var e=o.editor.project.get(),t=e.trees.getSelected(),n=t.blocks.getSelected();1===n.length?(d.original=n[0],d.block={title:d.original.title,description:d.original.description,properties:tine.merge({},d.original.properties)}):(d.original=!1,d.block=!1)}function n(o){setTimeout(function(){e.$apply(function(){t()})},0)}function i(){o.editor.on("blockselected",n),o.editor.on("blockdeselected",n),o.editor.on("blockremoved",n),o.editor.on("treeselected",n),o.editor.on("nodechanged",n)}function r(){o.editor.off("blockselected",n),o.editor.off("blockdeselected",n),o.editor.off("blockremoved",n),o.editor.off("treeselected",n),o.editor.off("nodechanged",n)}function l(e){return e.ctrlKey&&90==e.keyCode&&e.preventDefault(),!1}function c(){var e=o.editor.project.get(),t=e.trees.getSelected();t.blocks.update(d.original,d.block)}var d=this;d.original=null,d.block=null,d.update=c,d.keydown=l,i(),t(),e.$on("$destroy",r)}angular.module("app").controller("PropertiespanelController",e),e.$inject=["$scope","$window"]}();
!function(){"use strict";function e(e,t,o,r){function n(){f.trees=[];var e=t.editor.project.get(),o=e.trees.getSelected();e.trees.each(function(e){var t=e.blocks.getRoot();f.trees.push({id:e._id,name:t.title||"A behavior tree",active:e===o})})}function i(t){("blockchanged"!==t.type||"root"===t._target.category)&&(e.$$phase?n():e.$apply(function(){n()}))}function c(){t.editor.on("blockchanged",i),t.editor.on("treeselected",i),t.editor.on("treeremoved",i),t.editor.on("treeimported",i)}function d(){t.editor.off("blockchanged",i),t.editor.off("treeselected",i),t.editor.off("treeremoved",i),t.editor.off("treeimported",i)}function s(){var e=t.editor.project.get();e.trees.add()}function a(e){var o=t.editor.project.get();o.trees.select(e)}function l(e){o.confirm("Remove tree?","Are you sure you want to remove this tree?\n\nNote: all blocks using this tree will be removed.").then(function(){var o=t.editor.project.get();o.trees.remove(e),r.success("Tree removed","The tree has been removed from this project.")})}var f=this;f.trees=null,f.newTree=s,f.select=a,f.remove=l,c(),n(),e.$on("$destroy",d)}angular.module("app").controller("TreespanelController",e),e.$inject=["$scope","$window","dialogService","notificationService"]}();
!function(){"use strict";function e(e,o,n,t,i,r){function a(){var e=o.editor.project.get();if(t.name){var n=e.nodes.get(t.name);s.node=n.copy(),s.original=n,s.action="Update"}else s.node=new b3e.Node,s.node.category="composite";var i=[];e.nodes.each(function(e){e.name!==s.node.name&&i.push(e.name)}),s.blacklist=i.join(",")}function d(){var e=o.editor.project.get();s.original?e.nodes.update(s.original,s.node):e.nodes.add(s.node),n.go("editor"),r.success("Node created","Node has been created successfully.")}function c(){i.confirm("Remove node?","Are you sure you want to remove this node?\n\nNote: all blocks using this node will be removed.").then(function(){var e=o.editor.project.get();e.nodes.remove(s.original),r.success("Node removed","The node has been removed from this project."),n.go("editor")})}var s=this;s.action="New",s.node=null,s.blacklist=null,s.original=null,s.save=d,s.remove=c,a()}angular.module("app").controller("EditNodeController",e),e.$inject=["$scope","$window","$state","$stateParams","dialogService","notificationService"]}();
!function(){"use strict";function t(t,e,o,n,a,r,s){function c(){y.type=n.type,y.format=n.format;var t=o.editor["export"];"project"===y.type&&"json"===y.format?l(t.projectToData()):"tree"===y.type&&"json"===y.format?l(t.treeToData()):"nodes"===y.type&&"json"===y.format&&l(t.nodesToData())}function l(t){y.data=t,y.compact=JSON3.stringify(t),y.pretty=JSON3.stringify(t,null,2),y.result=y.pretty}function i(){var t=e[0].createRange();t.selectNodeContents(e[0].getElementById("export-result"));var n=o.getSelection();n.removeAllRanges(),n.addRange(t)}function u(){a.saveAs(null,[".json"]).then(function(t){s.saveAsync(t,y.pretty).then(function(){r.success("File saved","The file has been saved successfully.")})})}function p(){y.result=y.compact}function f(){y.result=y.pretty}var y=this;y.type=null,y.format=null,y.compact="",y.pretty="",y.result=null,y.data=null,y.hideCompact=!1,y.showCompact=p,y.showPretty=f,y.select=i,y.save=u,c()}angular.module("app").controller("ExportController",t),t.$inject=["$scope","$document","$window","$stateParams","dialogService","notificationService","storageService"]}();
!function(){"use strict";function t(t,e,o,r,a,n,i){function s(){l.type=r.type,l.format=r.format}function c(){a.openFile(!1,[".b3",".json"]).then(function(t){i.loadAsync(t).then(function(t){l.data=JSON3.stringify(t,null,2)})})}function d(){var t=e.editor["import"],r=JSON3.parse(l.data);try{if("project"===l.type&&"json"===l.format)t.projectAsData(r);else if("tree"===l.type&&"json"===l.format){var a=editor.project.get();if(!a)throw new Error("cannot find project");a.trees.add(r.id),t.treeAsData(r)}else"nodes"===l.type&&"json"===l.format&&t.nodesAsData(r)}catch(i){n.error("Invalid data","The provided data is invalid.")}o.go("editor")}var l=this;l.type=null,l.format=null,l.open=d,l.loadFromFile=c,l.data="",s()}angular.module("app").controller("ImportController",t),t.$inject=["$scope","$window","$state","$stateParams","dialogService","notificationService","storageService"]}();
!function(){"use strict";function e(e){function t(t,a,r){a.attr("draggable","true"),a.bind("dragstart",function(t){var a=e.editor.preview(r.name),n=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;if(n){var i=document.createElement("img");i.src=a.toDataURL();for(var o=(new Date).getTime(),d=o+10;d>o;)o=(new Date).getTime();a=i}t.dataTransfer.setData("name",r.name),t.dataTransfer.setDragImage(a,a.width/2,a.height/2)})}var a={restrict:"A",link:t};return a}angular.module("app").directive("b3DragNode",e),e.$inject=["$window"]}();
!function(){"use strict";function e(e){function t(t,n,r){n.bind("dragover",function(e){return e.preventDefault&&e.preventDefault(),!1}),n.bind("drop",function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation();var n=t.dataTransfer.getData("name"),r=e.editor.project.get(),a=r.trees.getSelected(),o=a.view.getLocalPoint(t.clientX,t.clientY);a.blocks.add(n,o.x,o.y),e.editor._game.canvas.focus()})}var n={restrict:"A",link:t};return n}angular.module("app").directive("b3DropNode",e),e.$inject=["$window"]}();
!function(){"use strict";function e(e){function o(o,n,l){o.keytable.heading=l.heading,o.keytable._onChange=e(l.ngChange);var r=l.ngModel;o.$watch(r,function(e){o.keytable.reset(e)})}var n={require:"^ngModel",restrict:"EA",replace:!0,bindToController:!0,controller:"KeyTableController",controllerAs:"keytable",templateUrl:"directives/keytable.html",link:o};return n}function o(e){function o(){if(a.model)for(var e in a.model)l(e,a.model[e],!1);else a.model={}}function n(e){a.rows=[],a.model=e,o()}function l(e,o,n){a.rows.push({key:e,value:o,fixed:n===!0})}function r(o){delete a.model[a.rows[o].key],a.rows.splice(o,1),a._onChange&&a._onChange(e)}function t(){for(var o in a.model)a.model.hasOwnProperty(o)&&delete a.model[o];for(var n=0;n<a.rows.length;n++){var l=a.rows[n];if(l.key){var r=l.value;isNaN(r)||""===r||(r=parseFloat(r)),a.model[l.key]=r,a._onChange&&a._onChange(e)}}}var a=this;a._onChange=null,a.model=e.keytable.model||e.model||null,a.rows=[],a.add=l,a.remove=r,a.change=t,a.reset=n,o()}angular.module("app").directive("b3KeyTable",e).controller("KeyTableController",o),e.$inject=["$parse"],o.$inject=["$scope"]}();
!function(){"use strict";function e(){function e(e,t,i,a){e.active=!!e.active,a.add(e)}var t={require:"^b3Tabset",restrict:"EA",scope:{active:"=?",heading:"@"},transclude:!0,templateUrl:"directives/tab.html",link:e};return t}angular.module("app").directive("b3Tab",e)}();
!function(){"use strict";function t(){var t={restrict:"EA",transclude:!0,replace:!0,scope:{},templateUrl:"directives/tabset.html",bindToController:!0,controllerAs:"tabset",controller:e};return t}function e(){function t(t){a.tabs.push(t)}function e(t){angular.forEach(a.tabs,function(e){e.active&&e!==t&&(e.active=!1)}),t.active=!0}var a=this;a.tabs=[],a.add=t,a.select=e}angular.module("app").directive("b3Tabset",t)}();
!function(){"use strict";function t(t,e,n,r,o,c,a){function i(){r.save(P,g)}function u(t){if(t){for(var e=g.length-1;e>=0;e--)g[e].path===t.path?g.splice(e,1):g[e].isOpen=!1;var n={name:t.name,description:t.description,path:t.path,isOpen:!0};g.splice(0,0,n)}else for(var r=0;r<g.length;r++)g[r].isOpen=!1;i()}function p(t){m=t,u(t),e.$broadcast("dash-projectchanged")}function s(){return t(function(t,e){if(!g){var n;try{n=r.load(P)}catch(o){}n||(n=[]),g=n}t(g)})}function f(e,n){return t(function(t,r){var o={name:n,description:"",data:[],path:e};a.newProject(),o.data=a.exportProject(),d(o).then(function(){p(o),t()})})}function l(){return m}function d(e){e=e||m;var o={name:e.name,description:e.description,data:a.exportProject()};return t(function(t,c){n.editor.clearDirty(),r.save(e.path,o),u(e),t()})}function h(e){return t(function(t,n){try{var o=r.load(e);o.path=e,a.openProject(o.data),p(o),t()}catch(c){n(c)}})}function j(){return t(function(t,e){n.editor.clearDirty(),a.closeProject(),p(null),t()})}function v(e){return t(function(t,n){for(var r=0;r<g.length;r++)if(g[r].path===e){g.splice(r,1);break}i(),t()})}var P=o.join(o.getDataPath(),"recents.json"),g=null,m=null,y={getRecentProjects:s,newProject:f,getProject:l,saveProject:d,openProject:h,closeProject:j,removeProject:v};return y}angular.module("app").factory("projectModel",t),t.$inject=["$q","$rootScope","$window","storageService","systemService","localStorageService","editorService"]}();
!function(){"use strict";function t(t,e,n,i){function s(){return t(function(t,n){if(!g){var s,a=i.getDefaultSettings();try{s=e.load(u),i.applySettings(s)}catch(r){}s||(s=a,e.save(u,s)),g=tine.merge({},a,s)}t(g)})}function a(n){return t(function(t,s){i.applySettings(n),e.save(u,n),g=n,t()})}function r(){return t(function(t,n){var s=i.getDefaultSettings();e.save(u,s),g=s,i.applySettings(s),t()})}var u=n.join(n.getDataPath(),"settings.json"),g=null,c={getSettings:s,saveSettings:a,resetSettings:r};return c}angular.module("app").factory("settingsModel",t),t.$inject=["$q","storageService","systemService","editorService"]}();
function dialogService(e,n,t,i){function o(e,t,i,o){return o=o||{},o.title=e,o.text=t,o.type=i,o.customClass=i,n(function(e){swal(o,function(){e()})})}function l(t,i,o,l){return l=l||{},l.title=t,l.text=i,l.type=o,l.customClass=o,l.showCancelButton=!0,n(function(n,t){e.swal(l,function(e){e?n():t()})})}function s(e,t,i,o,l){return l=l||{},l.title=e,l.text=t,l.type=i||"input",l.inputPlaceholder=o,l.customClass=i,l.showCancelButton=!0,n(function(e,n){swal(l,function(t){t!==!1?e(t):n(t)})})}function a(e,t){return n(function(n,t){var o=i.dialog.showSaveDialogSync({title:"Save project as...",defaultPath:e+".json",filters:[{name:"JSON",extensions:["json"]},{name:"All Files",extensions:["*"]}]});o?n(o):t()})}function c(e,t){return n(function(n,t){var o=i.dialog.showOpenDialogSync({title:"Open file...",properties:["openFile","multiSelections"],filters:[{name:"JSON",extensions:["json"]},{name:"All Files",extensions:["*"]}]});o?(e||(o=o[0]),n(o)):t()})}var u={alert:o,confirm:l,prompt:s,saveAs:a,openFile:c};return u}angular.module("app").factory("dialogService",dialogService),dialogService.$inject=["$window","$q","$document","nodejsService"];
function editorService(e){function t(){return e.b3e.DEFAULT_SETTINGS}function o(t){e.editor.applySettings(t)}function r(){e.editor.project.create()}function n(t){e.editor.project.open(t)}function i(){e.editor.project.close()}function c(){return e.editor["export"].projectToData()}var p={getDefaultSettings:t,applySettings:o,newProject:r,openProject:n,closeProject:i,exportProject:c};return p}angular.module("app").factory("editorService",editorService),editorService.$inject=["$window"];
function nodejsService(e){var r=!!e.require,n=r?require("electron").remote:null,i={ok:r,fs:r?e.require("fs"):null,path:r?e.require("path"):null,dialog:r?n.dialog:null};return i}angular.module("app").factory("nodejsService",nodejsService),nodejsService.$inject=["$window"];
function notificationService(i,n,t,e,a){function o(){for(var i=10,n=20,t=m.length-1;t>=0;t--){var e=m[t],a=parseInt(e[0].offsetHeight),o=n;n=o+a+i,e.css("bottom",o+"px")}}function s(i){var s='<div class="notification" ng-class="type">  <div class="notification-icon" ng-show="icon"><i class="fa fa-fw" ng-class="icon"></i></div>  <div class="notification-content" ng-class="{\'has-icon\': icon}">    <div class="notification-title" ng-show="title" ng-bind-html="title"></div>    <div class="notification-message" ng-bind-html="message"></div>  </div></div>',c={type:"default",title:"",message:"",icon:!1,delay:3e3};i=tine.merge({},c,i);var l=e.$new();l.type=i.type,l.title=a.trustAsHtml(i.title),l.message=a.trustAsHtml(i.message),l.icon=i.icon,l.delay=i.delay;var r=t(s)(l);r.bind("webkitTransitionEnd oTransitionEnd otransitionend transitionend msTransitionEnd click",function(i){i=i.originalEvent||i,("click"===i.type||r.hasClass("killed"))&&(r.remove(),m.remove(r),o())}),angular.isNumber(i.delay)&&n(function(){r.addClass("killed")},i.delay),n(function(){r.addClass("started"),o()},0),m.push(r),angular.element(document.getElementsByTagName("body")).append(r)}function c(i){s(i)}function l(i,n){s({title:i,message:n,type:"default"})}function r(i,n){s({title:i,message:n,icon:"fa-check",type:"success"})}function f(i,n){s({title:i,message:n,icon:"fa-close",type:"error"})}function d(i,n){s({title:i,message:n,icon:"fa-info",type:"info"})}function g(i,n){s({title:i,message:n,icon:"fa-warning",type:"warning"})}var m=[],u={notify:c,simple:l,success:r,error:f,info:d,warning:g};return u}angular.module("app").factory("notificationService",notificationService),notificationService.$inject=["$window","$timeout","$compile","$rootScope","$sce"];
function systemService(e,r){function t(e){try{r.fs.statSync(e)}catch(t){r.fs.mkdirSync(e)}}function n(){if(a){var e=process.env.APPDATA;e||(e=process.env.HOME+"/.behavior3");var r=s(e,"b3editor");return t(e),t(r),r}return"b3editor"}function s(){if(a)return r.path.join.apply(r.path,arguments);for(var e=arguments[0],t=1;t<arguments.length;t++)e+="-"+arguments[t];return e}var a=!!e.process,i={isDesktop:a,getDataPath:n,join:s};return i}angular.module("app").factory("systemService",systemService),systemService.$inject=["$window","nodejsService"];
!function(){"use strict";function t(){function t(t,i,n,r){var e=n.blacklist.split(",");r.$parsers.unshift(function(t){var i=-1===e.indexOf(t);return r.$setValidity("blacklist",i),i?t:void 0}),r.$formatters.unshift(function(t){return r.$setValidity("blacklist",-1===e.indexOf(t)),t})}var i={require:"ngModel",restrict:"A",link:t};return i}angular.module("app").directive("blacklist",t)}();
!function(){"use strict";function o(o,t){function n(){c.project=t.getProject()}var c=this;c.project=null,n(),o.$on("dash-projectchanged",function(){n()})}angular.module("app").controller("DashController",o),o.$inject=["$scope","projectModel"]}();
function EditorController(){}angular.module("app").controller("EditorController",EditorController),EditorController.$inject=[];
!function(){"use strict";function n(){function n(){}n()}angular.module("app").controller("HomeController",n),n.$inject=[]}();
!function(){"use strict";function e(e,o,t,n,r,c){function i(){p.isDesktop=n.isDesktop,c.getRecentProjects().then(function(e){p.recentProjects=e})}function s(o,t){c.newProject(o,t).then(function(){e.go("editor")})}function u(){function e(){t.prompt("New project",null,"input","Project name").then(function(e){if(!e)return void r.error("Invalid name","You must provide a name for the project.");if(p.isDesktop){var o=e.replace(/\s+/g,"_").toLowerCase();t.saveAs(o,[".json"]).then(function(o){s(o,e)})}else{var n="b3projects-"+b3.createUUID();s(n,e)}})}o.editor.isDirty()?t.confirm("Leave without saving?","If you proceed you will lose all unsaved modifications.",null,{closeOnConfirm:!1}).then(e):e()}function a(o){c.openProject(o).then(function(){e.go("editor")},function(e){console.error(e),r.error("Invalid file","Couldn't open the project file.")})}function l(e){function n(){e?a(e):t.openFile(!1,[".json"]).then(function(e){a(e)})["catch"](function(e){throw e})}o.editor.isDirty()?t.confirm("Leave without saving?","If you proceed you will lose all unsaved modifications.").then(n):n()}function f(){var e=c.getProject();t.prompt("Rename project",null,"input",e.name).then(function(o){return o?(e.name=o,void c.saveProject(e).then(function(){i(),r.success("Project renamed","The project has been renamed successfully.")})):void r.error("Invalid name","You must provide a name for the project.")})}function d(){c.saveProject().then(function(){r.success("Project saved","The project has been saved")},function(){r.error("Error","Project couldn't be saved")})}function j(){function e(){c.closeProject()}o.editor.isDirty()?t.confirm("Leave without saving?","If you proceed you will lose all unsaved modifications.",null).then(e):e()}function v(e){t.confirm("Remove project?","Are you sure you want to remove this project?").then(function(){c.removeProject(e).then(function(){i(),r.success("Project removed","The project has been removed from editor.")})})}var p=this;p.recentProjects=[],p.isDesktop=null,p.newProject=u,p.openProject=l,p.editProject=f,p.saveProject=d,p.closeProject=j,p.removeProject=v,i()}angular.module("app").controller("ProjectsController",e),e.$inject=["$state","$window","dialogService","systemService","notificationService","projectModel"]}();
!function(){"use strict";function t(t,e,n){function s(){e.getSettings().then(function(t){u.settings=t})}function i(){e.saveSettings(u.settings).then(function(){t.success("Settings saved","The editor settings has been updated.")})}function o(){n.confirm("Reset Settings?","Are you sure you want to reset to the default settings?").then(function(){e.resetSettings().then(function(){t.success("Settings reseted","The editor settings has been updated to default values."),s()})})}var u=this;u.settings={},u.saveSettings=i,u.resetSettings=o,s()}angular.module("app").controller("SettingsController",t),t.$inject=["notificationService","settingsModel","dialogService"]}();
function fileStorageService(e){function r(e,r){if("string"!=typeof r)try{r=JSON3.stringify(r)}catch(t){}var c=n.openSync(e,"w");n.writeSync(c,r),n.closeSync(c)}function t(e){var r=n.readFileSync(e,"utf-8");try{r=JSON3.parse(r)}catch(t){}return r}function c(e){}var i=e.ok,n=e.fs,o={ok:i,save:r,load:t,remove:c};return o}angular.module("app").factory("fileStorageService",fileStorageService),fileStorageService.$inject=["nodejsService"];
function localStorageService(a){function e(e,o){try{o=JSON.stringify(o)}catch(r){}a.localStorage[e]=o}function o(e){var o=a.localStorage[e];try{o=JSON.parse(o)}catch(r){}return o}function r(e){delete a.localStorage[e]}var c={ok:!!a.localStorage,save:e,load:o,remove:r};return c}angular.module("app").factory("localStorageService",localStorageService),localStorageService.$inject=["$window"];
function storageService(e,r,n){function t(e,r){v.save(e,r)}function c(r,n){return e(function(e,t){try{v.save(r,n),e()}catch(c){t(c)}})}function o(e){return v.load(e)}function a(r){return e(function(e,n){try{var t=v.load(r);e(t)}catch(c){n(c)}})}function i(e){v.remove(e)}function u(r){return e(function(e,n){try{v.remove(r),e()}catch(t){n(t)}})}var v=n.ok?n:r,f={save:t,saveAsync:c,load:o,loadAsync:a,remove:i,removeAsync:u};return f}angular.module("app").factory("storageService",storageService),storageService.$inject=["$q","localStorageService","fileStorageService"];
function startApp(){document.getElementById("page-preload");editor=new b3e.editor.Editor,angular.bootstrap(document,["app"])}var editor;